<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HÄ±zlÄ± Okuma ve AlÄ±ÅŸtÄ±rmalar</title>

  <style>
    body{
      font-family: Arial, sans-serif;
      background:#f5f5f5;
      display:flex;
      height:100vh;
      margin:0;
    }

    /* ANA Ä°Ã‡ERÄ°K */
    #mainContent{
      display:none;
      flex:1;
    }

    .left{
      flex:1;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#fff;
      border-right:2px solid #ddd;
      padding:20px;
    }
    .left img{
      max-width:100%;
      max-height:80%;
      object-fit:contain;
    }

    .right{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:14px;
      padding:20px;
    }

    .card{
      width:min(420px, 92%);
      background:#fff;
      border:1px solid #ddd;
      border-radius:10px;
      padding:14px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      cursor:pointer;
      transition: transform .08s ease, box-shadow .08s ease;
      text-align:left;
    }
    .card:hover{
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }
    .card h3{
      margin:0 0 6px 0;
      font-size:16px;
    }
    .card p{
      margin:0;
      color:#555;
      font-size:13px;
      line-height:1.35;
    }

    /* KOD OVERLAY */
    #overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.55);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:9999;
    }
    #overlayBox{
      width:min(520px, 92%);
      background:#fff;
      border-radius:12px;
      padding:18px 18px 14px 18px;
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }
    #overlayBox h2{
      margin:0 0 8px 0;
      font-size:18px;
    }
    #overlayBox p{
      margin:0 0 12px 0;
      color:#444;
      font-size:13px;
      line-height:1.4;
    }

    .code-wrapper{
      position:relative;
      width:100%;
      margin-top:6px;
    }
    .code-wrapper input{
      width:100%;
      padding:10px 44px 10px 10px; /* saÄŸa ikon boÅŸluÄŸu */
      font-size:16px;
      border:1px solid #ccc;
      border-radius:8px;
      box-sizing:border-box;
      outline:none;
    }
    .code-wrapper input:focus{
      border-color:#888;
    }

    #toggleCode{
      position:absolute;
      right:10px;
      top:50%;
      transform:translateY(-50%);
      cursor:pointer;
      font-size:18px;
      user-select:none;
      opacity:0.65;
    }
    #toggleCode:hover{ opacity:1; }

    .btnRow{
      display:flex;
      gap:10px;
      margin-top:12px;
      justify-content:flex-end;
    }
    button{
      padding:10px 12px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
    }
    #btnCheck{
      background:#2563eb;
      color:#fff;
    }
    #btnReset{
      background:#e5e7eb;
      color:#111827;
    }

    #msg{
      margin-top:10px;
      font-size:13px;
      color:#b91c1c;
      min-height:18px;
    }

    .mini{
      margin-top:10px;
      font-size:12px;
      color:#6b7280;
    }
  </style>
</head>

<body>

  <!-- KULLANICI KODU OVERLAY -->
  <div id="overlay">
    <div id="overlayBox">
      <h2>KullanÄ±cÄ± Kodu</h2>
      <p>Devam etmek iÃ§in kullanÄ±cÄ± kodunuzu giriniz.</p>

      <div class="code-wrapper">
        <input type="password" id="userCode" placeholder="KullanÄ±cÄ± kodunu giriniz" autocomplete="off" />
        <span id="toggleCode" title="GÃ¶ster/Gizle" onclick="toggleCodeVisibility()">ğŸ‘</span>
      </div>

      <div class="btnRow">
        <button id="btnReset" type="button" onclick="clearSavedCode()">SÄ±fÄ±rla</button>
        <button id="btnCheck" type="button" onclick="checkUserCode()">GiriÅŸ</button>
      </div>

      <div id="msg"></div>
      <div class="mini">Not: Kod doÄŸruysa tarayÄ±cÄ±da kaydedilir ve bir sonraki giriÅŸte tekrar sorulmayabilir.</div>
    </div>
  </div>

  <!-- ANA SAYFA Ä°Ã‡ERÄ°K -->
  <div id="mainContent">
    <div class="left">
      <!-- LOGO -->
      <img src="https://ilhantopaloglu.github.io/HizliOkuma/logo.png" alt="Logo" onerror="this.style.display='none'">
    </div>

    <div class="right">
      <div class="card" onclick="location.href='Uygulamalar/blok.html'">
        <h3>Blok Okuma</h3>
        <p>Blok okuma alÄ±ÅŸtÄ±rmalarÄ± ve metin Ã¼retme ekranÄ±.</p>
      </div>

      <div class="card" onclick="location.href='Uygulamalar/kelime.html'">
        <h3>Kelime Ã‡alÄ±ÅŸmasÄ±</h3>
        <p>Kelime gÃ¶sterimi, hÄ±z ve odak Ã§alÄ±ÅŸmalarÄ±.</p>
      </div>

      <div class="card" onclick="location.href='Uygulamalar/goz.html'">
        <h3>GÃ¶z Egzersizi</h3>
        <p>Odak ve takip egzersizleri.</p>
      </div>

      <div class="card" onclick="location.href='Uygulamalar/quiz.html'">
        <h3>Anlama Testi</h3>
        <p>Okuma sonrasÄ± sorular ile anlama takibi.</p>
      </div>
    </div>
  </div>

<script>
  const KOD_TXT_URL = "https://ilhantopaloglu.github.io/HizliOkuma/kod.txt";
  const STORAGE_KEY = "USER_CODE";

  // Sayfa aÃ§Ä±lÄ±ÅŸÄ±nda: kayÄ±tlÄ± kod varsa otomatik dene
  window.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved && saved.trim()) {
      // overlay'i kapatma: Ã¶nce doÄŸrula
      document.getElementById("userCode").value = saved;
      checkUserCode(true);
    }
  });

  function toggleCodeVisibility(){
    const input = document.getElementById("userCode");
    const icon  = document.getElementById("toggleCode");
    if (input.type === "password") {
      input.type = "text";
      icon.textContent = "ğŸ™ˆ";
    } else {
      input.type = "password";
      icon.textContent = "ğŸ‘";
    }
  }

  function showMsg(text, isError=true){
    const msg = document.getElementById("msg");
    msg.style.color = isError ? "#b91c1c" : "#065f46";
    msg.textContent = text || "";
  }

  function showMain(){
    document.getElementById("overlay").style.display = "none";
    document.getElementById("mainContent").style.display = "flex";
  }

  function clearSavedCode(){
    localStorage.removeItem(STORAGE_KEY);
    document.getElementById("userCode").value = "";
    showMsg("KayÄ±tlÄ± kod temizlendi. LÃ¼tfen tekrar giriÅŸ yapÄ±n.", false);
    // overlay zaten aÃ§Ä±k, main kapalÄ± kalsÄ±n
    document.getElementById("mainContent").style.display = "none";
    document.getElementById("overlay").style.display = "flex";
  }

  // kod.txt format Ã¶nerisi:
  // KOD;2025-01-01;2025-12-31
  // Ã–rn: ABC123;2025-01-01;2025-12-31
  //
  // Not: Tarih alanÄ± yoksa sadece kod kontrolÃ¼ de Ã§alÄ±ÅŸÄ±r (eÅŸleÅŸme yeter)
  async function checkUserCode(isAuto=false){
    const input = document.getElementById("userCode");
    const code = (input.value || "").trim();

    if (!code) {
      showMsg("LÃ¼tfen kullanÄ±cÄ± kodunu giriniz.");
      return;
    }

    showMsg(isAuto ? "KayÄ±tlÄ± kod kontrol ediliyor..." : "Kontrol ediliyor...", false);

    try{
      const res = await fetch(KOD_TXT_URL, { cache: "no-store" });
      if (!res.ok) throw new Error("kod.txt okunamadÄ±");
      const text = await res.text();

      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(Boolean);

      const now = new Date();
      let matched = false;
      let valid   = false;

      for (const line of lines) {
        // satÄ±r yorum ise geÃ§
        if (line.startsWith("#") || line.startsWith("//")) continue;

        // ayÄ±rÄ±cÄ± ; veya , olabilir
        const parts = line.split(/[;,]/).map(s => s.trim()).filter(Boolean);
        const fileCode = (parts[0] || "").trim();

        if (!fileCode) continue;

        if (fileCode === code) {
          matched = true;

          // tarih yoksa sadece eÅŸleÅŸme yeter
          if (parts.length < 3) {
            valid = true;
            break;
          }

          const startStr = parts[1];
          const endStr   = parts[2];

          const start = parseISODate(startStr);
          const end   = parseISODate(endStr);

          // tarih parse edilemediyse, yine de eÅŸleÅŸmeyi kabul etmeyelim (daha gÃ¼venli)
          if (!start || !end) {
            valid = false;
            break;
          }

          // bitiÅŸ gÃ¼nÃ¼nÃ¼ gÃ¼n sonuna kadar geÃ§erli say
          end.setHours(23,59,59,999);

          if (now >= start && now <= end) {
            valid = true;
          } else {
            valid = false;
          }
          break;
        }
      }

      if (!matched) {
        localStorage.removeItem(STORAGE_KEY);
        showMsg("KullanÄ±cÄ± kodu hatalÄ±.");
        return;
      }

      if (!valid) {
        localStorage.removeItem(STORAGE_KEY);
        showMsg("KullanÄ±cÄ± kodu sÃ¼resi geÃ§ersiz / dolmuÅŸ olabilir.");
        return;
      }

      // geÃ§erli -> kaydet ve iÃ§eriÄŸi aÃ§
      localStorage.setItem(STORAGE_KEY, code);
      showMsg("Kod doÄŸrulandÄ±. HoÅŸ geldiniz!", false);
      showMain();

    } catch(err){
      console.error(err);
      showMsg("DoÄŸrulama sÄ±rasÄ±nda hata oldu. Ä°nternet baÄŸlantÄ±nÄ±zÄ± veya kod.txt yolunu kontrol edin.");
    }
  }

  function parseISODate(s){
    // "YYYY-MM-DD" beklenir
    if (!s) return null;
    const m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
    if (!m) return null;
    const y = Number(m[1]);
    const mo = Number(m[2]) - 1;
    const d = Number(m[3]);
    const dt = new Date(y, mo, d);
    if (isNaN(dt.getTime())) return null;
    return dt;
  }

  // Enter ile giriÅŸ
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && document.getElementById("overlay").style.display !== "none") {
      checkUserCode(false);
    }
  });
</script>

</body>
</html>
